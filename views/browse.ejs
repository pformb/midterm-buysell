<!DOCTYPE html>
<html lang="en">

<head>
  <title>Browse</title>

  <meta charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0" >

  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" />
  <link rel="stylesheet" href="/vendor/border-box.css" />
  <link rel="stylesheet" href="/styles/browse.css" />
  <link rel="stylesheet" href="/styles/layout.css" />
  <link href="https://fonts.googleapis.com/css2?family=Chelsea+Market&display=swap" rel="stylesheet">

</head>

<header>
  <%- include('partials/_header') %>
</header>

<body>
  <h1>Filter Options:</h1>
  <div class="filter-form">
    <div class="category-select">
      <select name="categories" id="categories" onchange="handleCategoryChange()">
        <option value="" disabled selected>Select Category</option>
        <option value="Art">Art</option>
        <option value="Collectables">Collectables</option>
        <option value="Creations">Creations</option>
        <option value="Fashion">Fashion</option>
        <option value="Food">Food</option>
        <option value="Home/Garden">Home/Garden</option>
        <option value="Pets">Pets</option>
        <option value="Services">Services</option>
        <option value="Wood Working">Wood Working</option>
      </select>
    </div>

<div class="filter-price">
<label for="minPrice">Min Price:</label>
<textarea id="minPrice" name="minPrice" rows="1" placeholder="Enter min price"></textarea>
<br>
<label for="maxPrice">Max Price:</label>
<textarea id="maxPrice" name="maxPrice" rows="1" placeholder="Enter max price"></textarea>
</div>
<div class="filter-quantity">
  <label for="minQuantity">Min qty:</label>
  <textarea id="minQuantity" name="minQuantity" rows="1" placeholder="Enter min qty"></textarea>
  <br>
  <label for="maxPrice">Max qty:</label>
  <textarea id="maxQuantity" name="maxQuantity" rows="1" placeholder="Enter max qty"></textarea>
  </div>
  <div class="filter-button">
    <button type="submit" onclick="applyFilter()">Filter</button>
  </div>
</div>

 <!-- JavaScript functions for changing categories: -->
<script>
// Function to handle the change event of the category dropdown
function handleCategoryChange() {
  // Get the HTML element of the category dropdown
  let selectElement = document.getElementById("categories");
  // Get the value of the selected option in the dropdown
  let selectedCategory = selectElement.options[selectElement.selectedIndex].value;
  // Store the selected category in the session storage for later use
  sessionStorage.setItem('selectedCategory', selectedCategory);
}
// Function to apply the filter when the "Filter" button is clicked
function applyFilter() {
  // Retrieve the selected category from the session storage
  let selectedCategory = sessionStorage.getItem('selectedCategory');
  // Check if a category is selected
  if (selectedCategory) {
    // Construct the URL with the selected category
    let url = "http://localhost:8080/browse/" + encodeURIComponent(selectedCategory);
    // Use window.location.href to navigate to the URL, effectively reloading the page
    window.location.href = url;
  } else {
    // If no category is selected, simply reload the current page
    window.location.reload();
  }
}
// Function to clear the session storage after the page loads
function clearSession() {
  // Remove the 'selectedCategory' item from the session storage
  sessionStorage.removeItem('selectedCategory');
}
// Attach the clearSession function to the window.onload event
window.onload = clearSession;

</script>

    <!-- Use EJS syntax for looping through data -->
    <div class="product-container">
    <% data.forEach((product) => { %>
      <div class="product-box">
      <div> <%= product.title %> </div>
      <div class="product-description">
      <div> <%= product.description %> </div>
    </div>
      <div> <%= product.price %> </div>

      <div> qty: <%= product.quantity %> </div>
      <div> <img src="/<%= product.thumbnail %>" /> </div>
      <button class="add-cart">Add to Cart</button>
    </div>
    <% }) %>

  </div>
</body>

</html>
